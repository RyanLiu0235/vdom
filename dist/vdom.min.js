!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.vdom=t()}(this,function(){"use strict";var e=function e(t,n,r){n=n||{},r=r||[],this.tagName=t,this.props=n,this.key=n.key,this.children=r;for(var i,a=0,o=0;o<r.length;o++)(i=r[o])instanceof e&&(a+=i.count),a++;this.count=a};var t=function e(t){for(var n,r=document.createElement(t.tagName),i=t.props,a=Object.keys(i),o=0;o<a.length;o++)n=a[o],r.setAttribute(n,i[n]);for(var s,c=t.children,f=0;f<c.length;f++)if(s=c[f],["string","number"].indexOf(typeof s)>-1){var h=document.createTextNode(s);r.appendChild(h)}else{var u=e(s);r.appendChild(u)}return r};function n(e,t){for(var n={},i=[],a=0,o=e.length;a<o;a++){var s=e[a],c=r(s,t);c?n[c]=a:i.push(s)}return{keyIndex:n,free:i}}function r(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}var i={makeKeyIndexAndFree:n,diff:function(e,t,i){for(var a,o,s=n(e,i),c=n(t,i),f=c.free,h=s.keyIndex,u=c.keyIndex,l=[],p=[],d=0,v=0;d<e.length;){if(o=r(a=e[d],i))if(u.hasOwnProperty(o)){var g=u[o];p.push(t[g])}else p.push(null);else{var y=f[v++];p.push(y||null)}d++}var m=p.slice(0);for(d=0;d<m.length;)null===m[d]?(O(d),b(d)):d++;for(var E=d=0;d<t.length;){o=r(a=t[d],i);var R=m[E],k=r(R,i);R?o===k?E++:h.hasOwnProperty(o)&&r(m[E+1],i)===o?(O(d),b(E),E++):P(d,a):P(d,a),d++}function O(e){var t={index:e,type:0};l.push(t)}function P(e,t){var n={index:e,item:t,type:1};l.push(n)}function b(e){m.splice(e,1)}return{moves:l,children:p}}}.diff,a={isString:function(e){return"string"==typeof e}},o={REPLACE:"REPLACE",REORDER:"REORDER",PROPS:"PROPS",TEXT:"TEXT"};function s(e,n){var r=n.patch;switch(n.type){case o.REPLACE:var i=a.isString(r)?r:t(r);e.parentNode.replaceChild(i,e);break;case o.REORDER:!function(e,n){for(var r,i,a,o,s=e.childNodes,c=(s.length,0);c<n.length;c++)switch(r=n[c],i=r.index,a=r.item,o=s[i],r.type){case 0:e.removeChild(o);break;case 1:var f=t(a);e.insertBefore(f,o)}}(e,r.moves);break;case o.PROPS:!function(e,t){for(var n,r=Object.keys(t),i=0;i<r.length;i++)n=r[i],e.setAttribute(n,t[n])}(e,r);break;case o.TEXT:var s=document.createTextNode(r);e.parentNode.replaceChild(s,e)}}return{h:function(t,n,r){return new e(t,n,r)},render:t,diff:function(e,t){var n={};return function e(t,n,r,s){var c=[];if(null===n);else if(a.isString(t)&&a.isString(n))t!==n&&c.push({type:o.TEXT,patch:n});else if(t.tagName===n.tagName&&t.key===n.key){for(var f,h=t.props,u=n.props,l=Object.assign({},h,u),p=Object.keys(l),d={},v=0;v<p.length;v++)f=p[v],u[f]!==h[f]&&(d[f]=u[f]);Object.keys(d).length>0&&c.push({type:o.PROPS,patch:d});var g=t.children,y=i(g,n.children,"key"),m=y.moves,E=y.children;m.length>0&&c.push({type:o.REORDER,patch:{moves:m}});for(var R,k,O=null,P=r,b=0;b<g.length;b++)R=g[b],k=E[b],P+=O&&O.count?O.count:1,e(R,k,P,s),O=R}else c.push({type:o.REPLACE,patch:n});c.length>0&&(s[r]=c)}(e,t,0,n),n},patch:function(e,t){!function e(t,n,r){var i=n[r];if(!a.isString(t))for(var o=t.childNodes,c=0;c<o.length;c++)e(o[c],n,++r);if(i)for(var f=0;f<i.length;f++)s(t,i[f])}(e,t,0)}}});
